// generated by koffee 0.16.0

/*
00000000   00000000  00000000   000      
000   000  000       000   000  000      
0000000    0000000   00000000   000      
000   000  000       000        000      
000   000  00000000  000        0000000
 */
var Koffee, addHistory, addMultilineHandler, fs, getCommandId, merge, nodeREPL, path, ref, replDefaults, runInContext, updateSyntaxError, vm;

fs = require('fs');

path = require('path');

vm = require('vm');

nodeREPL = require('repl');

Koffee = require('./koffee');

ref = require('./helpers'), merge = ref.merge, updateSyntaxError = ref.updateSyntaxError;

replDefaults = {
    prompt: 'koffee> ',
    historyFile: process.env.HOME ? path.join(process.env.HOME, '.koffee_history') : void 0,
    historyMaxInputSize: 10240,
    "eval": function(input, context, filename, cb) {
        var Assign, Block, Literal, Value, ast, err, js, ref1, referencedVars, token, tokens;
        input = input.replace(/\uFF00/g, '\n');
        input = input.replace(/^\(([\s\S]*)\n\)$/m, '$1');
        input = input.replace(/^\s*try\s*{([\s\S]*)}\s*catch.*$/m, '$1');
        ref1 = require('./nodes'), Block = ref1.Block, Assign = ref1.Assign, Value = ref1.Value, Literal = ref1.Literal;
        try {
            tokens = Koffee.tokens(input);
            referencedVars = (function() {
                var i, len, results;
                results = [];
                for (i = 0, len = tokens.length; i < len; i++) {
                    token = tokens[i];
                    if (token[0] === 'IDENTIFIER') {
                        results.push(token[1]);
                    }
                }
                return results;
            })();
            ast = Koffee.nodes(tokens);
            js = ast.compile({
                bare: true,
                locals: Object.keys(context),
                referencedVars: referencedVars
            });
            return cb(null, runInContext(js, context, filename));
        } catch (error) {
            err = error;
            updateSyntaxError(err, input);
            return cb(err);
        }
    }
};

runInContext = function(js, context, filename) {
    if (context === global) {
        return vm.runInThisContext(js, filename);
    } else {
        return vm.runInContext(js, context, filename);
    }
};

addMultilineHandler = function(repl) {
    var inputStream, multiline, nodeLineListener, origPrompt, outputStream, ref1, rli;
    rli = repl.rli, inputStream = repl.inputStream, outputStream = repl.outputStream;
    origPrompt = (ref1 = repl._prompt) != null ? ref1 : repl.prompt;
    multiline = {
        enabled: false,
        initialPrompt: origPrompt.replace(/^[^> ]*/, function(x) {
            return x.replace(/./g, '-');
        }),
        prompt: origPrompt.replace(/^[^> ]*>?/, function(x) {
            return x.replace(/./g, '.');
        }),
        buffer: ''
    };
    nodeLineListener = rli.listeners('line')[0];
    rli.removeListener('line', nodeLineListener);
    rli.on('line', function(cmd) {
        if (multiline.enabled) {
            multiline.buffer += cmd + "\n";
            rli.setPrompt(multiline.prompt);
            rli.prompt(true);
        } else {
            rli.setPrompt(origPrompt);
            nodeLineListener(cmd);
        }
    });
    return inputStream.on('keypress', function(char, key) {
        if (!(key && key.ctrl && !key.meta && !key.shift && key.name === 'v')) {
            return;
        }
        if (multiline.enabled) {
            if (!multiline.buffer.match(/\n/)) {
                multiline.enabled = !multiline.enabled;
                rli.setPrompt(origPrompt);
                rli.prompt(true);
                return;
            }
            if ((rli.line != null) && !rli.line.match(/^\s*$/)) {
                return;
            }
            multiline.enabled = !multiline.enabled;
            rli.line = '';
            rli.cursor = 0;
            rli.output.cursorTo(0);
            rli.output.clearLine(1);
            multiline.buffer = multiline.buffer.replace(/\n/g, '\uFF00');
            rli.emit('line', multiline.buffer);
            multiline.buffer = '';
        } else {
            multiline.enabled = !multiline.enabled;
            rli.setPrompt(multiline.initialPrompt);
            rli.prompt(true);
        }
    });
};

addHistory = function(repl, filename, maxSize) {
    var buffer, fd, lastLine, readFd, size, stat;
    lastLine = null;
    try {
        stat = fs.statSync(filename);
        size = Math.min(maxSize, stat.size);
        readFd = fs.openSync(filename, 'r');
        buffer = Buffer.alloc(size);
        fs.readSync(readFd, buffer, 0, size, stat.size - size);
        fs.closeSync(readFd);
        repl.rli.history = buffer.toString().split('\n').reverse();
        if (stat.size > maxSize) {
            repl.rli.history.pop();
        }
        if (repl.rli.history[0] === '') {
            repl.rli.history.shift();
        }
        repl.rli.historyIndex = -1;
        lastLine = repl.rli.history[0];
    } catch (error) {}
    fd = fs.openSync(filename, 'a');
    repl.rli.addListener('line', function(code) {
        if (code && code.length && code !== '.history' && code !== '.exit' && lastLine !== code) {
            fs.writeSync(fd, code + "\n");
            return lastLine = code;
        }
    });
    repl.on('exit', function() {
        return fs.closeSync(fd);
    });
    return repl.commands[getCommandId(repl, 'history')] = {
        help: 'Show command history',
        action: function() {
            repl.outputStream.write((repl.rli.history.slice(0).reverse().join('\n')) + "\n");
            return repl.displayPrompt();
        }
    };
};

getCommandId = function(repl, commandName) {
    var commandsHaveLeadingDot;
    commandsHaveLeadingDot = repl.commands['.help'] != null;
    if (commandsHaveLeadingDot) {
        return "." + commandName;
    } else {
        return commandName;
    }
};

module.exports = {
    start: function(opts) {
        var build, major, minor, ref1, repl;
        if (opts == null) {
            opts = {};
        }
        ref1 = process.versions.node.split('.').map(function(n) {
            return parseInt(n, 10);
        }), major = ref1[0], minor = ref1[1], build = ref1[2];
        if (major < 10) {
            console.warn("Node 10.0.0+ required for koffee REPL");
            process.exit(1);
        }
        Koffee.register();
        process.argv = ['koffee'].concat(process.argv.slice(2));
        opts = merge(replDefaults, opts);
        repl = nodeREPL.start(opts);
        if (opts.prelude) {
            runInContext(opts.prelude, repl.context, 'prelude');
        }
        repl.on('exit', function() {
            if (!repl.rli.closed) {
                return repl.outputStream.write('\n');
            }
        });
        addMultilineHandler(repl);
        if (opts.historyFile) {
            addHistory(repl, opts.historyFile, opts.historyMaxInputSize);
        }
        repl.commands[getCommandId(repl, 'load')].help = 'Load code from a file into this REPL session';
        return repl;
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwbC5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUE7O0FBUUEsRUFBQSxHQUFXLE9BQUEsQ0FBUSxJQUFSOztBQUNYLElBQUEsR0FBVyxPQUFBLENBQVEsTUFBUjs7QUFDWCxFQUFBLEdBQVcsT0FBQSxDQUFRLElBQVI7O0FBQ1gsUUFBQSxHQUFXLE9BQUEsQ0FBUSxNQUFSOztBQUNYLE1BQUEsR0FBVyxPQUFBLENBQVEsVUFBUjs7QUFFWCxNQUE2QixPQUFBLENBQVEsV0FBUixDQUE3QixFQUFDLGlCQUFELEVBQVE7O0FBUVIsWUFBQSxHQUVJO0lBQUEsTUFBQSxFQUFRLFVBQVI7SUFDQSxXQUFBLEVBQThELE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBN0QsR0FBQSxJQUFJLENBQUMsSUFBTCxDQUFVLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBdEIsRUFBNEIsaUJBQTVCLENBQUEsR0FBQSxNQURiO0lBRUEsbUJBQUEsRUFBcUIsS0FGckI7SUFJQSxDQUFBLElBQUEsQ0FBQSxFQUFNLFNBQUMsS0FBRCxFQUFRLE9BQVIsRUFBaUIsUUFBakIsRUFBMkIsRUFBM0I7QUFFRixZQUFBO1FBQUEsS0FBQSxHQUFRLEtBQUssQ0FBQyxPQUFOLENBQWMsU0FBZCxFQUF5QixJQUF6QjtRQUNSLEtBQUEsR0FBUSxLQUFLLENBQUMsT0FBTixDQUFjLG9CQUFkLEVBQW9DLElBQXBDO1FBQ1IsS0FBQSxHQUFRLEtBQUssQ0FBQyxPQUFOLENBQWMsbUNBQWQsRUFBbUQsSUFBbkQ7UUFFUixPQUFvQyxPQUFBLENBQVEsU0FBUixDQUFwQyxFQUFFLGtCQUFGLEVBQVMsb0JBQVQsRUFBaUIsa0JBQWpCLEVBQXdCO0FBRXhCO1lBQ0ksTUFBQSxHQUFTLE1BQU0sQ0FBQyxNQUFQLENBQWMsS0FBZDtZQUNULGNBQUE7O0FBQW1CO3FCQUFBLHdDQUFBOzt3QkFBa0MsS0FBTSxDQUFBLENBQUEs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SUFBSSxDQUFDLE9BQWhDLEVBQXlDLFNBQXpDLEVBQUE7O1FBQ0EsSUFBSSxDQUFDLEVBQUwsQ0FBUSxNQUFSLEVBQWdCLFNBQUE7WUFBRyxJQUFnQyxDQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBN0M7dUJBQUEsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFsQixDQUF3QixJQUF4QixFQUFBOztRQUFILENBQWhCO1FBQ0EsbUJBQUEsQ0FBb0IsSUFBcEI7UUFDQSxJQUErRCxJQUFJLENBQUMsV0FBcEU7WUFBQSxVQUFBLENBQVcsSUFBWCxFQUFpQixJQUFJLENBQUMsV0FBdEIsRUFBbUMsSUFBSSxDQUFDLG1CQUF4QyxFQUFBOztRQUVBLElBQUksQ0FBQyxRQUFTLENBQUEsWUFBQSxDQUFhLElBQWIsRUFBbUIsTUFBbkIsQ0FBQSxDQUEyQixDQUFDLElBQTFDLEdBQWlEO2VBQ2pEO0lBakJHLENBQVAiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwICAgICAgXG4wMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgIFxuMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAgICAgICBcbjAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAgMDAwICAgICAgXG4wMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAgICAgIDAwMDAwMDAgIFxuIyMjXG5cbmZzICAgICAgID0gcmVxdWlyZSAnZnMnXG5wYXRoICAgICA9IHJlcXVpcmUgJ3BhdGgnXG52bSAgICAgICA9IHJlcXVpcmUgJ3ZtJ1xubm9kZVJFUEwgPSByZXF1aXJlICdyZXBsJ1xuS29mZmVlICAgPSByZXF1aXJlICcuL2tvZmZlZSdcblxue21lcmdlLCB1cGRhdGVTeW50YXhFcnJvcn0gPSByZXF1aXJlICcuL2hlbHBlcnMnXG5cbiMgMDAwMDAwMCAgICAwMDAwMDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAwMDAwMDAgICAwMDAwMDAwICBcbiMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAwMDAgICAgIDAwMCAgICAgICBcbiMgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwMDAwICAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAwMDAgICAgIDAwMDAwMDAgICBcbiMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAwMDAgICAgICAgICAgMDAwICBcbiMgMDAwMDAwMCAgICAwMDAwMDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAwMDAgICAgIDAwMDAwMDAgICBcblxucmVwbERlZmF1bHRzID1cbiAgICBcbiAgICBwcm9tcHQ6ICdrb2ZmZWU+ICcsXG4gICAgaGlzdG9yeUZpbGU6IHBhdGguam9pbiBwcm9jZXNzLmVudi5IT01FLCAnLmtvZmZlZV9oaXN0b3J5JyBpZiBwcm9jZXNzLmVudi5IT01FXG4gICAgaGlzdG9yeU1heElucHV0U2l6ZTogMTAyNDBcbiAgICBcbiAgICBldmFsOiAoaW5wdXQsIGNvbnRleHQsIGZpbGVuYW1lLCBjYikgLT5cbiAgICAgICAgXG4gICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSAvXFx1RkYwMC9nLCAnXFxuJyAjIFhYWDogbXVsdGlsaW5lIGhhY2suXG4gICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSAvXlxcKChbXFxzXFxTXSopXFxuXFwpJC9tLCAnJDEnICMgTm9kZSdzIFJFUEwgc2VuZHMgdGhlIGlucHV0IGVuZGluZyB3aXRoIGEgbmV3bGluZSBhbmQgdGhlbiB3cmFwcGVkIGluIHBhcmVucy4gVW53cmFwIGFsbCB0aGF0LlxuICAgICAgICBpbnB1dCA9IGlucHV0LnJlcGxhY2UgL15cXHMqdHJ5XFxzKnsoW1xcc1xcU10qKX1cXHMqY2F0Y2guKiQvbSwgJyQxJyAjIE5vZGUncyBSRVBMIHY2LjkuMSsgc2VuZHMgdGhlIGlucHV0IHdyYXBwZWQgaW4gYSB0cnkvY2F0Y2ggc3RhdGVtZW50LiBVbndyYXAgdGhhdCB0b28uXG5cbiAgICAgICAgeyBCbG9jaywgQXNzaWduLCBWYWx1ZSwgTGl0ZXJhbCB9ID0gcmVxdWlyZSAnLi9ub2RlcydcblxuICAgICAgICB0cnlcbiAgICAgICAgICAgIHRva2VucyA9IEtvZmZlZS50b2tlbnMgaW5wdXRcbiAgICAgICAgICAgIHJlZmVyZW5jZWRWYXJzID0gKCB0b2tlblsxXSBmb3IgdG9rZW4gaW4gdG9rZW5zIHdoZW4gdG9rZW5bMF0gaXMgJ0lERU5USUZJRVInIClcbiAgICAgICAgICAgIGFzdCA9IEtvZmZlZS5ub2RlcyB0b2tlbnNcbiAgICAgICAgICAgICMgYXN0ID0gbmV3IEJsb2NrIFsgIyBBZGQgYXNzaWdubWVudCB0byBgX2AgdmFyaWFibGUgdG8gZm9yY2UgdGhlIGlucHV0IHRvIGJlIGFuIGV4cHJlc3Npb24uXG4gICAgICAgICAgICAgICAgIyBuZXcgQXNzaWduIChuZXcgVmFsdWUgbmV3IExpdGVyYWwgJ19fJyksIGFzdCwgJz0nXG4gICAgICAgICAgICAjIF1cbiAgICAgICAgICAgIGpzID0gYXN0LmNvbXBpbGUgXG4gICAgICAgICAgICAgICAgYmFyZTogICAgICAgICAgIHllc1xuICAgICAgICAgICAgICAgIGxvY2FsczogICAgICAgICBPYmplY3Qua2V5cyBjb250ZXh0XG4gICAgICAgICAgICAgICAgcmVmZXJlbmNlZFZhcnM6IHJlZmVyZW5jZWRWYXJzXG4gICAgICAgICAgICAjIGxvZyBqc1xuICAgICAgICAgICAgY2IgbnVsbCwgcnVuSW5Db250ZXh0IGpzLCBjb250ZXh0LCBmaWxlbmFtZVxuICAgICAgICBjYXRjaCBlcnJcbiAgICAgICAgICAgICMgQVNUJ3MgYGNvbXBpbGVgIGRvZXMgbm90IGFkZCBzb3VyY2UgY29kZSBpbmZvcm1hdGlvbiB0byBzeW50YXggZXJyb3JzLlxuICAgICAgICAgICAgdXBkYXRlU3ludGF4RXJyb3IgZXJyLCBpbnB1dFxuICAgICAgICAgICAgY2IgZXJyXG5cbnJ1bkluQ29udGV4dCA9IChqcywgY29udGV4dCwgZmlsZW5hbWUpIC0+XG4gICAgaWYgY29udGV4dCBpcyBnbG9iYWxcbiAgICAgICAgdm0ucnVuSW5UaGlzQ29udGV4dCBqcywgZmlsZW5hbWVcbiAgICBlbHNlXG4gICAgICAgIHZtLnJ1bkluQ29udGV4dCBqcywgY29udGV4dCwgZmlsZW5hbWVcblxuYWRkTXVsdGlsaW5lSGFuZGxlciA9IChyZXBsKSAtPlxuICAgIHtybGksIGlucHV0U3RyZWFtLCBvdXRwdXRTdHJlYW19ID0gcmVwbFxuICAgICMgTm9kZSAwLjExLjEyIGNoYW5nZWQgQVBJLCBwcm9tcHQgaXMgbm93IF9wcm9tcHQuXG4gICAgb3JpZ1Byb21wdCA9IHJlcGwuX3Byb21wdCA/IHJlcGwucHJvbXB0XG5cbiAgICBtdWx0aWxpbmUgPVxuICAgICAgICBlbmFibGVkOiBvZmZcbiAgICAgICAgaW5pdGlhbFByb21wdDogb3JpZ1Byb21wdC5yZXBsYWNlIC9eW14+IF0qLywgKHgpIC0+IHgucmVwbGFjZSAvLi9nLCAnLSdcbiAgICAgICAgcHJvbXB0OiBvcmlnUHJvbXB0LnJlcGxhY2UgL15bXj4gXSo+Py8sICh4KSAtPiB4LnJlcGxhY2UgLy4vZywgJy4nXG4gICAgICAgIGJ1ZmZlcjogJydcblxuICAgICMgUHJveHkgbm9kZSdzIGxpbmUgbGlzdGVuZXJcbiAgICBub2RlTGluZUxpc3RlbmVyID0gcmxpLmxpc3RlbmVycygnbGluZScpWzBdXG4gICAgcmxpLnJlbW92ZUxpc3RlbmVyICdsaW5lJywgbm9kZUxpbmVMaXN0ZW5lclxuICAgIHJsaS5vbiAnbGluZScsIChjbWQpIC0+XG4gICAgICAgIGlmIG11bHRpbGluZS5lbmFibGVkXG4gICAgICAgICAgICBtdWx0aWxpbmUuYnVmZmVyICs9IFwiI3tjbWR9XFxuXCJcbiAgICAgICAgICAgIHJsaS5zZXRQcm9tcHQgbXVsdGlsaW5lLnByb21wdFxuICAgICAgICAgICAgcmxpLnByb21wdCB0cnVlXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJsaS5zZXRQcm9tcHQgb3JpZ1Byb21wdFxuICAgICAgICAgICAgbm9kZUxpbmVMaXN0ZW5lciBjbWRcbiAgICAgICAgcmV0dXJuXG5cbiAgICAjIEhhbmRsZSBDdHJsLXYgKG11bHRpbGluZSlcbiAgICBcbiAgICBpbnB1dFN0cmVhbS5vbiAna2V5cHJlc3MnLCAoY2hhciwga2V5KSAtPlxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHVubGVzcyBrZXkgYW5kIGtleS5jdHJsIGFuZCBub3Qga2V5Lm1ldGEgYW5kIG5vdCBrZXkuc2hpZnQgYW5kIGtleS5uYW1lIGlzICd2J1xuICAgICAgICBcbiAgICAgICAgaWYgbXVsdGlsaW5lLmVuYWJsZWRcbiAgICAgICAgICAgICMgYWxsb3cgYXJiaXRyYXJpbHkgc3dpdGNoaW5nIGJldHdlZW4gbW9kZXMgYW55IHRpbWUgYmVmb3JlIG11bHRpcGxlIGxpbmVzIGFyZSBlbnRlcmVkXG4gICAgICAgICAgICB1bmxlc3MgbXVsdGlsaW5lLmJ1ZmZlci5tYXRjaCAvXFxuL1xuICAgICAgICAgICAgICAgIG11bHRpbGluZS5lbmFibGVkID0gbm90IG11bHRpbGluZS5lbmFibGVkXG4gICAgICAgICAgICAgICAgcmxpLnNldFByb21wdCBvcmlnUHJvbXB0XG4gICAgICAgICAgICAgICAgcmxpLnByb21wdCB0cnVlXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAjIG5vLW9wIHVubGVzcyB0aGUgY3VycmVudCBsaW5lIGlzIGVtcHR5XG4gICAgICAgICAgICByZXR1cm4gaWYgcmxpLmxpbmU/IGFuZCBub3QgcmxpLmxpbmUubWF0Y2ggL15cXHMqJC9cbiAgICAgICAgICAgICMgZXZhbCwgcHJpbnQsIGxvb3BcbiAgICAgICAgICAgIG11bHRpbGluZS5lbmFibGVkID0gbm90IG11bHRpbGluZS5lbmFibGVkXG4gICAgICAgICAgICBybGkubGluZSA9ICcnXG4gICAgICAgICAgICBybGkuY3Vyc29yID0gMFxuICAgICAgICAgICAgcmxpLm91dHB1dC5jdXJzb3JUbyAwXG4gICAgICAgICAgICBybGkub3V0cHV0LmNsZWFyTGluZSAxXG4gICAgICAgICAgICAjIFhYWDogbXVsdGlsaW5lIGhhY2tcbiAgICAgICAgICAgIG11bHRpbGluZS5idWZmZXIgPSBtdWx0aWxpbmUuYnVmZmVyLnJlcGxhY2UgL1xcbi9nLCAnXFx1RkYwMCdcbiAgICAgICAgICAgIHJsaS5lbWl0ICdsaW5lJywgbXVsdGlsaW5lLmJ1ZmZlclxuICAgICAgICAgICAgbXVsdGlsaW5lLmJ1ZmZlciA9ICcnXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIG11bHRpbGluZS5lbmFibGVkID0gbm90IG11bHRpbGluZS5lbmFibGVkXG4gICAgICAgICAgICBybGkuc2V0UHJvbXB0IG11bHRpbGluZS5pbml0aWFsUHJvbXB0XG4gICAgICAgICAgICBybGkucHJvbXB0IHRydWVcbiAgICAgICAgcmV0dXJuXG5cbmFkZEhpc3RvcnkgPSAocmVwbCwgZmlsZW5hbWUsIG1heFNpemUpIC0+XG4gICAgXG4gICAgbGFzdExpbmUgPSBudWxsXG4gICAgdHJ5XG4gICAgICAgICMgR2V0IGZpbGUgaW5mbyBhbmQgYXQgbW9zdCBtYXhTaXplIG9mIGNvbW1hbmQgaGlzdG9yeVxuICAgICAgICBzdGF0ID0gZnMuc3RhdFN5bmMgZmlsZW5hbWVcbiAgICAgICAgc2l6ZSA9IE1hdGgubWluIG1heFNpemUsIHN0YXQuc2l6ZVxuICAgICAgICAjIFJlYWQgbGFzdCBgc2l6ZWAgYnl0ZXMgZnJvbSB0aGUgZmlsZVxuICAgICAgICByZWFkRmQgPSBmcy5vcGVuU3luYyBmaWxlbmFtZSwgJ3InXG4gICAgICAgIGJ1ZmZlciA9IEJ1ZmZlci5hbGxvYyhzaXplKVxuICAgICAgICBmcy5yZWFkU3luYyByZWFkRmQsIGJ1ZmZlciwgMCwgc2l6ZSwgc3RhdC5zaXplIC0gc2l6ZVxuICAgICAgICBmcy5jbG9zZVN5bmMgcmVhZEZkXG4gICAgICAgICMgU2V0IHRoZSBoaXN0b3J5IG9uIHRoZSBpbnRlcnByZXRlclxuICAgICAgICByZXBsLnJsaS5oaXN0b3J5ID0gYnVmZmVyLnRvU3RyaW5nKCkuc3BsaXQoJ1xcbicpLnJldmVyc2UoKVxuICAgICAgICAjIElmIHRoZSBoaXN0b3J5IGZpbGUgd2FzIHRydW5jYXRlZCB3ZSBzaG91bGQgcG9wIG9mZiBhIHBvdGVudGlhbCBwYXJ0aWFsIGxpbmVcbiAgICAgICAgcmVwbC5ybGkuaGlzdG9yeS5wb3AoKSBpZiBzdGF0LnNpemUgPiBtYXhTaXplXG4gICAgICAgICMgU2hpZnQgb2ZmIHRoZSBmaW5hbCBibGFuayBuZXdsaW5lXG4gICAgICAgIHJlcGwucmxpLmhpc3Rvcnkuc2hpZnQoKSBpZiByZXBsLnJsaS5oaXN0b3J5WzBdIGlzICcnXG4gICAgICAgIHJlcGwucmxpLmhpc3RvcnlJbmRleCA9IC0xXG4gICAgICAgIGxhc3RMaW5lID0gcmVwbC5ybGkuaGlzdG9yeVswXVxuXG4gICAgZmQgPSBmcy5vcGVuU3luYyBmaWxlbmFtZSwgJ2EnXG5cbiAgICByZXBsLnJsaS5hZGRMaXN0ZW5lciAnbGluZScsIChjb2RlKSAtPlxuICAgICAgICBpZiBjb2RlIGFuZCBjb2RlLmxlbmd0aCBhbmQgY29kZSAhPSAnLmhpc3RvcnknIGFuZCBjb2RlICE9ICcuZXhpdCcgYW5kIGxhc3RMaW5lICE9IGNvZGVcbiAgICAgICAgICAgICMgU2F2ZSB0aGUgbGF0ZXN0IGNvbW1hbmQgaW4gdGhlIGZpbGVcbiAgICAgICAgICAgIGZzLndyaXRlU3luYyBmZCwgXCIje2NvZGV9XFxuXCJcbiAgICAgICAgICAgIGxhc3RMaW5lID0gY29kZVxuXG4gICAgcmVwbC5vbiAnZXhpdCcsIC0+IGZzLmNsb3NlU3luYyBmZFxuXG4gICAgcmVwbC5jb21tYW5kc1tnZXRDb21tYW5kSWQocmVwbCwgJ2hpc3RvcnknKV0gPSAjIEFkZCBhIGNvbW1hbmQgdG8gc2hvdyB0aGUgaGlzdG9yeSBzdGFja1xuICAgICAgICBoZWxwOiAnU2hvdyBjb21tYW5kIGhpc3RvcnknXG4gICAgICAgIGFjdGlvbjogLT5cbiAgICAgICAgICAgIHJlcGwub3V0cHV0U3RyZWFtLndyaXRlIFwiI3tyZXBsLnJsaS5oaXN0b3J5Wy4uXS5yZXZlcnNlKCkuam9pbiAnXFxuJ31cXG5cIlxuICAgICAgICAgICAgcmVwbC5kaXNwbGF5UHJvbXB0KClcblxuZ2V0Q29tbWFuZElkID0gKHJlcGwsIGNvbW1hbmROYW1lKSAtPlxuXG4gICAgY29tbWFuZHNIYXZlTGVhZGluZ0RvdCA9IHJlcGwuY29tbWFuZHNbJy5oZWxwJ10/XG4gICAgaWYgY29tbWFuZHNIYXZlTGVhZGluZ0RvdCB0aGVuIFwiLiN7Y29tbWFuZE5hbWV9XCIgZWxzZSBjb21tYW5kTmFtZVxuXG5tb2R1bGUuZXhwb3J0cyA9XG4gICAgXG4gICAgc3RhcnQ6IChvcHRzID0ge30pIC0+XG4gICAgICAgIFttYWpvciwgbWlub3IsIGJ1aWxkXSA9IHByb2Nlc3MudmVyc2lvbnMubm9kZS5zcGxpdCgnLicpLm1hcCAobikgLT4gcGFyc2VJbnQobiwgMTApXG5cbiAgICAgICAgaWYgbWFqb3IgPCAxMFxuICAgICAgICAgICAgY29uc29sZS53YXJuIFwiTm9kZSAxMC4wLjArIHJlcXVpcmVkIGZvciBrb2ZmZWUgUkVQTFwiXG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQgMVxuXG4gICAgICAgIEtvZmZlZS5yZWdpc3RlcigpXG4gICAgICAgIHByb2Nlc3MuYXJndiA9IFsna29mZmVlJ10uY29uY2F0IHByb2Nlc3MuYXJndlsyLi5dXG4gICAgICAgIG9wdHMgPSBtZXJnZSByZXBsRGVmYXVsdHMsIG9wdHNcbiAgICAgICAgcmVwbCA9IG5vZGVSRVBMLnN0YXJ0IG9wdHNcbiAgICAgICAgcnVuSW5Db250ZXh0IG9wdHMucHJlbHVkZSwgcmVwbC5jb250ZXh0LCAncHJlbHVkZScgaWYgb3B0cy5wcmVsdWRlXG4gICAgICAgIHJlcGwub24gJ2V4aXQnLCAtPiByZXBsLm91dHB1dFN0cmVhbS53cml0ZSAnXFxuJyBpZiBub3QgcmVwbC5ybGkuY2xvc2VkXG4gICAgICAgIGFkZE11bHRpbGluZUhhbmRsZXIgcmVwbFxuICAgICAgICBhZGRIaXN0b3J5IHJlcGwsIG9wdHMuaGlzdG9yeUZpbGUsIG9wdHMuaGlzdG9yeU1heElucHV0U2l6ZSBpZiBvcHRzLmhpc3RvcnlGaWxlXG4gICAgICAgICMgQWRhcHQgaGVscCBpbmhlcml0ZWQgZnJvbSB0aGUgbm9kZSBSRVBMXG4gICAgICAgIHJlcGwuY29tbWFuZHNbZ2V0Q29tbWFuZElkKHJlcGwsICdsb2FkJyldLmhlbHAgPSAnTG9hZCBjb2RlIGZyb20gYSBmaWxlIGludG8gdGhpcyBSRVBMIHNlc3Npb24nXG4gICAgICAgIHJlcGxcbiJdfQ==
//# sourceURL=../coffee/repl.coffee